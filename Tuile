package netwalk;

import Outils.Data;

/**
 * Représente une case (Tuile) du plateau de jeu Netwalk.
 * Contient l'état de la tuyauterie et gère l'affichage.
 * * @author lvulin
 */
public class Tuile {

    private int code;           // Configuration binaire des connexions (1=N, 2=E, 4=S, 8=O)
    private boolean feuille;    // Vrai si la tuile est un terminal (1 seule connexion)
    private boolean serveur;    // Vrai si la tuile est la source
    private boolean visitee;    // Utilisé pour les algorithmes de parcours

    /**
     * Constructeur par défaut.
     * @param code Configuration initiale des connexions.
     */
    public Tuile(int code) {
        this(code, false, false, false);
    }

    /**
     * Constructeur complet.
     * @param code Configuration des connexions.
     * @param feuille Est un terminal.
     * @param serveur Est la source.
     * @param visitee A été visitée.
     */
    public Tuile(int code, boolean feuille, boolean serveur, boolean visitee) {
        this.code = code;
        this.feuille = feuille;
        this.serveur = serveur;
        this.visitee = visitee;
    }

    // --- Getters et Setters ---

    public int getCode() { return code; }
    public void setCode(int code) { this.code = code; }

    public boolean isFeuille() { return feuille; }
    public void setFeuille(boolean feuille) { this.feuille = feuille; }

    public boolean isServeur() { return serveur; }
    public void setServeur(boolean serveur) { this.serveur = serveur; }

    public boolean isVisitee() { return visitee; }
    public void setVisitee(boolean visitee) { this.visitee = visitee; }

    // --- Méthodes Métier ---

    /**
     * Effectue une rotation de 90 degrés vers la droite (sens horaire).
     * Les connexions sont décalées : N->E, E->S, S->O, O->N.
     */
    public void rotationDroite() {
        // Le bit de poids fort (8=Ouest) doit devenir le bit de poids faible (1=Nord)
        int bitOuest = (code & 8) != 0 ? 1 : 0;
        // Décalage à gauche des autres bits et masque pour rester sur 4 bits (15 = 1111)
        this.code = ((code << 1) & 15) | bitOuest;
    }

    /**
     * Effectue une rotation de 90 degrés vers la gauche (sens anti-horaire).
     */
    public void rotationGauche() {
        // Le bit de poids faible (1=Nord) doit devenir le bit de poids fort (8=Ouest)
        int bitNord = (code & 1) != 0 ? 8 : 0;
        this.code = (code >> 1) | bitNord;
    }

    @Override
    public String toString() {
        // Récupération du caractère graphique depuis Outils.Data
        String representation = (code >= 0 && code < Data.asciiGraphic.length) 
                                ? Data.asciiGraphic[code] 
                                : "   ";

        // Application des couleurs selon l'état de la tuile
        if (serveur) {
            return Data.RED + representation + Data.RESET;
        }
        if (feuille) {
            return Data.BLUE + representation + Data.RESET;
        }
        return representation;
    }
}
